NDVI <- mean(cropped_spat)
#NDVI_var <- var(cropped_spat)
NDVI_sd <- stdev(cropped_spat)
# Store as a data frame in the list
res[[l]] <- data.frame(park = test_parks[l],
date = file_month,
ndvi = NDVI,
ndvi_var = NDVI_sd)
} #close the loop over parks
#Extract the desired park contour
PARK <- CAshape[CAshape$CLAB_ID %in% test_parks[l],]
plot(PARK)
test_parks[[l]]
l
RES
res
stdev(cropped_spat)
mean(cropped_spat)
# Get mean and variance in NDVI
NDVI <- mean(cropped_spat)
NDVI
# Get mean and variance in NDVI
NDVI <- terra::mean(cropped_spat)
NDVI
?mean
# Get mean and variance in NDVI
NDVI <- terra::mean(cropped_spat, na.rm = TRUE)
NDVI
plot(NDVI)
class(NDVI)
# Get mean and variance in NDVI
NDVI <- terra::global(cropped_spat, 'mean', na.rm = TRUE)
NDVI
# Get mean and variance in NDVI
NDVI <- terra::global(na.omit(cropped_spat), 'mean')
NDVI
plot(na.omit(cropped_spat))
plot(cropped_spat)
# crop the NDVI raster to the park
cropped_spat <- crop(reprojected_spat, PARK, mask = TRUE)
plot(cropped_spat)
l
l <- 1
#Extract the desired park contour
PARK <- CAshape[CAshape$CLAB_ID %in% test_parks[l],]
# Generate an empty list for storing results
res <- list()
plot(PARK)
# crop the NDVI raster to the park
cropped_spat <- crop(reprojected_spat, PARK, mask = TRUE)
plot(cropped_spat)
plot(PARK, add = TRUE)
# crop the NDVI raster to the park
cropped_spat <- crop(reprojected_spat, PARK)
plot(cropped_spat)
# crop the NDVI raster to the park
cropped_spat <- mask(reprojected_spat, PARK)
plot(cropped_spat)
# crop the NDVI raster to the park
cropped_spat <- crop(reprojected_spat, PARK, mask = TRUE)
plot(cropped_spat)
plot(PARK, add = TRUE)
class(PARK)
PARK <- vect(PARK)
class(PARK)
# crop the NDVI raster to the park
cropped_spat <- crop(reprojected_spat, PARK, mask = TRUE)
plot(cropped_spat)
CRS(cropped_spat)
crs(PARK)
crs(PARK) == crs(cropped_spat)
# crop the NDVI raster to the park
cropped_spat <- crop(reprojected_spat, PARK, mask = TRUE, snap = "in")
plot(cropped_spat)
# crop the NDVI raster to the park
cropped_spat <- crop(reprojected_spat, PARK, mask = TRUE, snap = "in")
plot(cropped_spat)
mean(cropped_spat)
terra::global(na.omit(cropped_spat), 'mean')
test <- mean(cropped_spat)
test$mean
values(cropped_spat)
mean(values(cropped_spat), na.action = na.omit)
mean(values(cropped_spat), na.rm = TRUE)
# Get mean and variance in NDVI
NDVI <- mean(values(cropped_spat), na.rm = TRUE)
#NDVI_var <- var(cropped_spat)
NDVI_var <- var(values(cropped_spat), na.rm = TRUE)
# Store as a data frame in the list
res[[l]] <- data.frame(park = test_parks[l],
date = file_month,
ndvi = NDVI,
ndvi_var = NDVI_var)
RES
res
nc.files[k]
year <- gsub(pattern = "ndvi",
replacement = "",
x = gsub(pattern = "C:/Users/grace/Documents/GitHub/HWI_parks/ndvi/",
replacement = "",
x = year_folders[i]))
year
paste(year,j,k,sep = "_")
# Generate an empty list for storing results
res <- list()
#Loop over the vector of park names to extract the NDVI information
for(l in 1:length(test_parks)){
#Extract the desired park contour
PARK <- CAshape[CAshape$CLAB_ID %in% test_parks[l],]
# crop the NDVI raster to the park
cropped_spat <- crop(reprojected_spat, PARK, mask = TRUE, snap = "in")
# Get mean and variance in NDVI
NDVI <- mean(values(cropped_spat), na.rm = TRUE)
#NDVI_var <- var(cropped_spat)
NDVI_var <- var(values(cropped_spat), na.rm = TRUE)
# Store as a data frame in the list
res[[l]] <- data.frame(park = test_parks[l],
date = paste(year,j,k,sep = "_"),
ndvi = NDVI,
ndvi_var = NDVI_var)
} #close the loop over parks
#clean up the results
RES <- do.call(rbind,res)
RES
# Generate an empty list for storing results
res <- list()
#Loop over the vector of park names to extract the NDVI information
for(l in 1:length(test_parks)){
#Extract the desired park contour
PARK <- CAshape[CAshape$CLAB_ID %in% test_parks[l],]
# crop the NDVI raster to the park
cropped_spat <- crop(reprojected_spat, PARK, mask = TRUE)
# Get mean and variance in NDVI
NDVI <- mean(values(cropped_spat), na.rm = TRUE)
#NDVI_var <- var(cropped_spat)
NDVI_var <- var(values(cropped_spat), na.rm = TRUE)
# Store as a data frame in the list
res[[l]] <- data.frame(park = test_parks[l],
date = paste(year,j,k,sep = "_"),
ndvi = NDVI,
ndvi_var = NDVI_var)
} #close the loop over parks
#clean up the results
RES <- do.call(rbind,res)
RES
# Generate an empty list for storing results
res_day <- list()
# Generate an empty list for storing results
res_day <- list()
# Loop through all the ndvi files for the current month
for (k in 1:length(nc.files)) {
# make the spatrasters
spat <- rast(nc.files[k]) # took 2012 nov 2, 10, oct 9, 10/ 2018 nov 6 out to run this
spat <- spat[[which(names(spat) == "NDVI")]]
# Reproject the raster to the CRS of jasper_shape
reprojected_spat <- terra::project(spat,
CRS_canada,
method = "near")
# Generate an empty list for storing results
res <- list()
#Loop over the vector of park names to extract the NDVI information
for(l in 1:length(test_parks)){
#Extract the desired park contour
PARK <- CAshape[CAshape$CLAB_ID %in% test_parks[l],]
# crop the NDVI raster to the park
cropped_spat <- crop(reprojected_spat, PARK, mask = TRUE)
# Get mean and variance in NDVI
NDVI <- mean(values(cropped_spat), na.rm = TRUE)
#NDVI_var <- var(cropped_spat)
NDVI_var <- var(values(cropped_spat), na.rm = TRUE)
# Store as a data frame in the list
res[[l]] <- data.frame(park = test_parks[l],
date = paste(year,j,k,sep = "_"),
ndvi = NDVI,
ndvi_var = NDVI_var)
} #close the loop over parks
#clean up the results
res_day[[k]] <- do.call(rbind,res)
} #close of day loop
res_day
#clean up the results over the months of the year
res_month[[j]] <- do.call(rbind,res_day)
# Generate an empty list for storing daily results
res_month <- list()
#clean up the results over the months of the year
res_month[[j]] <- do.call(rbind,res_day)
res_month
View(res_month)
test <- data.frame(res_month)
test <- do.call(rbind, res_month)
View(test)
# Loading packages ----
options(timeout = max(1000, getOption("timeout")))
library(lattice) # for making graphs
library(knitr) # for knitting
library(ggplot2) # for scatter plot
library(dplyr) # for pipes
library(skimr) # for skimming data
library(tidyverse) #summing
library(lubridate) #convert whole columns to dates
library(zoo) #dates as year month
library(canadianmaps) #import annotated map of Canada
library(sf) # spatial data
library(sp) #Spatial Points function
library(rstudioapi) #for creating colour palette
library(grDevices) #for creating colour palette
library(fBasics) #for creating colour palette
library(mgcv) #gam
library(terra) #shape file
library(xml2)
library(rvest)
library(raster)
nc.year_dir <- "C:/Users/grace/Documents/GitHub/HWI_parks/ndvi"
setwd(nc.year_dir)
# import all of the boundaries for Canadian parks
CAshape <- st_read("C:/Users/grace/Documents/GitHub/HWI_parks/data/CLAB_CA_2023-09-08")
# Create a list of the names of the 25 parks to be studied
test_parks <- c("WATE", "ELKI", "JASP", "WOOD",
"BANF", "YOHO", "KOOT", "REVE",
"PRIM", "GLAC", "WAPU", "FUND",
"KOUC", "NOVA", "KEJI", "AULA",
"NAHA", "FIVE", "PELE", "GBIS",
"THIS", "PEIS", "FORI", "PALB", "IVVA")
# import JASP shapefile
jasper_shape <- readRDS("../rds/jasper.rds")
# Define the CRS
CRS_canada <- crs(jasper_shape)
# List all year folders in the ndvi directory
year_folders <- list.dirs(path = nc.year_dir, full.names = TRUE, recursive = FALSE)
RESULTS <- list()
# Loop through each year folder
for (i in 1:length(i:1)) { #length(year_folders)
year <- gsub(pattern = "ndvi",
replacement = "",
x = gsub(pattern = "C:/Users/grace/Documents/GitHub/HWI_parks/ndvi/",
replacement = "",
x = year_folders[i]))
# List all month folders in the year folder
month_folders <- list.dirs(path = year_folders[i],
full.names = TRUE,
recursive = FALSE)
# Generate an empty list for storing daily results
res_month <- list()
# Loop through each month folder
for (j in 1:length(month_folders)) {
# Make a list of the files in the month directory
nc.files <- list.files(path = month_folders[j],
pattern = "*.nc",
full.names = TRUE)
# Generate an empty list for storing daily results
res_day <- list()
# Loop through all the ndvi files for the current month
for (k in 1:length(nc.files)) {
# make the spatrasters
spat <- rast(nc.files[k]) # took 2012 nov 2, 10, oct 9, 10/ 2018 nov 6 out to run this
spat <- spat[[which(names(spat) == "NDVI")]]
# Reproject the raster to the CRS of jasper_shape
reprojected_spat <- terra::project(spat,
CRS_canada,
method = "near")
# Generate an empty list for storing results
res <- list()
#Loop over the vector of park names to extract the NDVI information
for(l in 1:length(test_parks)){
#Extract the desired park contour
PARK <- CAshape[CAshape$CLAB_ID %in% test_parks[l],]
# crop the NDVI raster to the park
cropped_spat <- crop(reprojected_spat, PARK, mask = TRUE)
# Get mean and variance in NDVI
NDVI <- mean(values(cropped_spat), na.rm = TRUE)
#NDVI_var <- var(cropped_spat)
NDVI_var <- var(values(cropped_spat), na.rm = TRUE)
# Store as a data frame in the list
res[[l]] <- data.frame(park = test_parks[l],
date = paste(year,j,k,sep = "_"),
ndvi = NDVI,
ndvi_var = NDVI_var)
} #close the loop over parks
#clean up the results over the days of the month
res_day[[k]] <- do.call(rbind,res)
} #close of day loop
#clean up the results over the months of the year
res_month[[j]] <- do.call(rbind,res_day)
} # close of the month loop
#clean up the results over the months of the year
RESULTS[[i]] <- do.call(rbind,res_month)
} # close of year loop
# convert the final list to a data frame
RESULTS <- do.call(rbind,RESULTS)
View(RESULTS)
# Loop through each year folder
for (i in 1:length(i:2)) { #length(year_folders)
year <- gsub(pattern = "ndvi",
replacement = "",
x = gsub(pattern = "C:/Users/grace/Documents/GitHub/HWI_parks/ndvi/",
replacement = "",
x = year_folders[i]))
# List all month folders in the year folder
month_folders <- list.dirs(path = year_folders[i],
full.names = TRUE,
recursive = FALSE)
# Generate an empty list for storing daily results
res_month <- list()
# Loop through each month folder
for (j in 1:length(month_folders)) {
# Make a list of the files in the month directory
nc.files <- list.files(path = month_folders[j],
pattern = "*.nc",
full.names = TRUE)
# Generate an empty list for storing daily results
res_day <- list()
# Loop through all the ndvi files for the current month
for (k in 1:length(nc.files)) {
# make the spatrasters
spat <- rast(nc.files[k]) # took 2012 nov 2, 10, oct 9, 10/ 2018 nov 6 out to run this
spat <- spat[[which(names(spat) == "NDVI")]]
# Reproject the raster to the CRS of jasper_shape
reprojected_spat <- terra::project(spat,
CRS_canada,
method = "near")
# Generate an empty list for storing results
res <- list()
#Loop over the vector of park names to extract the NDVI information
for(l in 1:length(test_parks)){
#Extract the desired park contour
PARK <- CAshape[CAshape$CLAB_ID %in% test_parks[l],]
# crop the NDVI raster to the park
cropped_spat <- crop(reprojected_spat, PARK, mask = TRUE)
# Get mean and variance in NDVI
NDVI <- mean(values(cropped_spat), na.rm = TRUE)
#NDVI_var <- var(cropped_spat)
NDVI_var <- var(values(cropped_spat), na.rm = TRUE)
# Store as a data frame in the list
res[[l]] <- data.frame(park = test_parks[l],
date = paste(year,j,k,sep = "_"),
ndvi = NDVI,
ndvi_var = NDVI_var)
} #close the loop over parks
#clean up the results over the days of the month
res_day[[k]] <- do.call(rbind,res)
} #close of day loop
#clean up the results over the months of the year
res_month[[j]] <- do.call(rbind,res_day)
} # close of the month loop
#clean up the results over the months of the year
RESULTS[[i]] <- do.call(rbind,res_month)
} # close of year loop
# convert the final list to a data frame
RESULTS <- do.call(rbind,RESULTS)
View(RESULTS)
# Loading packages ----
options(timeout = max(1000, getOption("timeout")))
library(lattice) # for making graphs
library(knitr) # for knitting
library(ggplot2) # for scatter plot
library(dplyr) # for pipes
library(skimr) # for skimming data
library(tidyverse) #summing
library(lubridate) #convert whole columns to dates
library(zoo) #dates as year month
library(canadianmaps) #import annotated map of Canada
library(sf) # spatial data
library(sp) #Spatial Points function
library(rstudioapi) #for creating colour palette
library(grDevices) #for creating colour palette
library(fBasics) #for creating colour palette
library(mgcv) #gam
library(terra) #shape file
library(xml2)
library(rvest)
library(raster)
#SAVE AS RDA OR CSV
save(RESULTS, file = "test.rda")
load(test.rds)
load("test.rds")
load("C:/Users/grace/Documents/GitHub/HWI_parks/test.rda")
View(test)
test5 <- load("C:/Users/grace/Documents/GitHub/HWI_parks/test.rda")
#SAVE AS RDA OR CSV
#save(RESULTS, file = "test.rda")
write.csv(RESULTS, "C:/Users/grace/Documents/GitHub/HWI_parks/results/parksndvi.csv", row.names=FALSE)
test6 <- read.csv("parksndvi")
test6 <- read.csv("results/parksndvi.csv")
View(test6)
#SAVE AS RDA OR CSV
#save(RESULTS, file = "test.rda")
write.csv(RESULTS, "C:/Users/grace/Documents/GitHub/HWI_parks/results/parksndvi.csv", row.names=TRUE)
test6 <- read.csv("results/parksndvi.csv")
View(test6)
nc.year_dir <- "C:/Users/grace/Documents/GitHub/HWI_parks/ndvi"
setwd(nc.year_dir)
# import all of the boundaries for Canadian parks
CAshape <- st_read("C:/Users/grace/Documents/GitHub/HWI_parks/data/CLAB_CA_2023-09-08")
# Create a list of the names of the 25 parks to be studied
test_parks <- c("WATE", "ELKI", "JASP", "WOOD",
"BANF", "YOHO", "KOOT", "REVE",
"PRIM", "GLAC", "WAPU", "FUND",
"KOUC", "NOVA", "KEJI", "AULA",
"NAHA", "FIVE", "PELE", "GBIS",
"THIS", "PEIS", "FORI", "PALB", "IVVA")
# import JASP shapefile
jasper_shape <- readRDS("../rds/jasper.rds")
# Define the CRS
CRS_canada <- crs(jasper_shape)
# List all year folders in the ndvi directory
year_folders <- list.dirs(path = nc.year_dir, full.names = TRUE, recursive = FALSE)
RESULTS <- list()
# Loop through each year folder
for (i in 1:length(year_folders)) { #length(year_folders)
year <- gsub(pattern = "ndvi",
replacement = "",
x = gsub(pattern = "C:/Users/grace/Documents/GitHub/HWI_parks/ndvi/",
replacement = "",
x = year_folders[i]))
# List all month folders in the year folder
month_folders <- list.dirs(path = year_folders[i],
full.names = TRUE,
recursive = FALSE)
# Generate an empty list for storing daily results
res_month <- list()
# Loop through each month folder
for (j in 1:length(month_folders)) {
# Make a list of the files in the month directory
nc.files <- list.files(path = month_folders[j],
pattern = "*.nc",
full.names = TRUE)
# Generate an empty list for storing daily results
res_day <- list()
# Loop through all the ndvi files for the current month
for (k in 1:length(nc.files)) {
# make the spatrasters
spat <- rast(nc.files[k]) # took 2012 nov 2, 10, oct 9, 10/ 2018 nov 6 out to run this
spat <- spat[[which(names(spat) == "NDVI")]]
# Reproject the raster to the CRS of jasper_shape
reprojected_spat <- terra::project(spat,
CRS_canada,
method = "near")
# Generate an empty list for storing results
res <- list()
#Loop over the vector of park names to extract the NDVI information
for(l in 1:length(test_parks)){
#Extract the desired park contour
PARK <- CAshape[CAshape$CLAB_ID %in% test_parks[l],]
# crop the NDVI raster to the park
cropped_spat <- crop(reprojected_spat, PARK, mask = TRUE)
# Get mean and variance in NDVI
NDVI <- mean(values(cropped_spat), na.rm = TRUE)
#NDVI_var <- var(cropped_spat)
NDVI_var <- var(values(cropped_spat), na.rm = TRUE)
# Store as a data frame in the list
res[[l]] <- data.frame(park = test_parks[l],
date = paste(year,j,k,sep = "_"),
ndvi = NDVI,
ndvi_var = NDVI_var)
} #close the loop over parks
#clean up the results over the days of the month
res_day[[k]] <- do.call(rbind,res)
} #close of day loop
#clean up the results over the months of the year
res_month[[j]] <- do.call(rbind,res_day)
} # close of the month loop
#clean up the results over the months of the year
RESULTS[[i]] <- do.call(rbind,res_month)
} # close of year loop
# convert the final list to a data frame
RESULTS <- do.call(rbind,RESULTS)
View(RESULTS)
#SAVE AS RDA OR CSV
#save(RESULTS, file = "test.rda")
write.csv(RESULTS, "C:/Users/grace/Documents/GitHub/HWI_parks/results/parksndvi.csv", row.names=FALSE)
test_csv <- read.csv("results/parksndvi.csv")
test_csv <- read.csv("../results/parksndvi.csv")
View(test_csv)
RESULTS_csv <- read.csv("../results/parksndvi.csv")
RESULTS_csv <- read.csv("results/parksndvi.csv")
#Create data frame by grouping park means according to months and years
test <- aggregate(RESULTS_csv ~ park + ndvi, data = RESULTS_csv, FUN = "length")
#Create data frame by grouping park means according to months and years
test <- aggregate( ~ park + ndvi, data = RESULTS_csv, FUN = "length")
#Create data frame by grouping park means according to months and years
test <- aggregate(RESULTS ~ park + ndvi + date, data = RESULTS_csv, FUN = "length")
#Create data frame by grouping park means according to months and years
test <- aggregate(park ~ ndvi + date, data = RESULTS_csv, FUN = "length")
View(test)
#Create data frame by grouping park means according to months and years
test <- aggregate(. ~ park + ndvi + date, data = RESULTS_csv, FUN = "length")
View(test)
#Create data frame by grouping park means according to months and years
test <- aggregate(. ~ park + ndvi + date, data = RESULTS_csv, FUN = "length")
View(test)
# Loading packages ----
options(timeout = max(1000, getOption("timeout")))
library(lattice) # for making graphs
library(knitr) # for knitting
library(ggplot2) # for scatter plot
library(dplyr) # for pipes
library(skimr) # for skimming data
library(tidyverse) #summing
library(lubridate) #convert whole columns to dates
library(zoo) #dates as year month
library(canadianmaps) #import annotated map of Canada
library(sf) # spatial data
library(sp) #Spatial Points function
library(rstudioapi) #for creating colour palette
library(grDevices) #for creating colour palette
library(fBasics) #for creating colour palette
library(mgcv) #gam
library(terra) #shape file
library(xml2)
library(rvest)
library(raster)
RESULTS_csv <- read.csv("results/parksndvi.csv")
